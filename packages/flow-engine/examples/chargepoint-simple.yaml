# Simplified Chargepoint Installation Flow
# Compatible with the YamlFlowParser format

id: chargepoint-installation-simple
initial: initiated

states:
  # 1. Initiation
  initiated:
    entry: "console.log('ğŸš€ Installation initiated')"
    on:
      start_assessment: assessing

  # 2. Assessment
  assessing:
    entry: "console.log('ğŸ“‹ Conducting site assessment...'); context.siteSurvey = { completed: true, parkingSpacesSuitable: true }; context.electricalAssessment = { completed: true, panelCapacity: 200, availableCapacity: 80 }"
    on:
      assessment_done: quote_generated

  # 3. Quote & Approval
  quote_generated:
    entry: "console.log('ğŸ’° Quote generated'); context.payment = { depositAmount: 900, finalAmount: 2100, depositPaid: false, finalPaymentPaid: false }"
    on:
      customer_approved: deposit_collected
      customer_rejected: cancelled

  # 4. Payment
  deposit_collected:
    entry: "console.log('ğŸ’³ Deposit collected'); context.payment.depositPaid = true"
    on:
      proceed: permits_applied

  # 5. Permits
  permits_applied:
    entry: "console.log('ğŸ“ Permit application submitted'); context.permits = { required: true, submitted: true, approved: false }"
    on:
      permits_approved: scheduled
      permits_denied: cancelled

  # 6. Scheduling
  scheduled:
    entry: "console.log('ğŸ“… Installation scheduled'); context.permits.approved = true; context.schedule = { proposedDate: new Date(), estimatedDuration: 4, crewSize: 2 }"
    on:
      begin_installation: installing

  # 7. Installation
  installing:
    entry: "console.log('ğŸ”§ Installing chargepoint...'); context.installation = { status: 'in_progress', chargepointsInstalled: 0 }; context.installation.status = 'completed'; context.installation.chargepointsInstalled = context.quantity"
    on:
      installation_done: testing

  # 8. Testing
  testing:
    entry: "console.log('ğŸ§ª Testing and commissioning...'); context.commissioning = { allTestsPassed: false, powerTest: true, connectivityTest: true, safetyTest: true }"
    on:
      tests_passed: walkthrough
      tests_failed: troubleshooting

  troubleshooting:
    entry: "console.log('ğŸ” Troubleshooting issues...')"
    on:
      issue_resolved: testing
      cannot_fix: failed

  # 9. Customer Acceptance
  walkthrough:
    entry: "console.log('ğŸ‘¥ Customer walkthrough'); context.commissioning.allTestsPassed = true; context.commissioning.certificationNumber = 'CERT-' + Date.now()"
    on:
      customer_accepts: final_payment
      customer_rejects: addressing_concerns

  addressing_concerns:
    entry: "console.log('ğŸ”§ Addressing concerns...')"
    on:
      concerns_resolved: walkthrough

  final_payment:
    entry: "console.log('ğŸ’³ Collecting final payment'); context.payment.finalPaymentPaid = true"
    on:
      payment_received: completing

  # 10. Completion
  completing:
    entry: "console.log('ğŸ“‹ Finalizing documentation...'); context.customerApproval = { accepted: true, signedOff: true, completedAt: new Date().toISOString() }"
    on:
      docs_complete: completed

  # Terminal states
  completed:
    entry: "console.log('âœ… Installation completed successfully!')"
    final: true

  cancelled:
    entry: "console.log('âŒ Installation cancelled')"
    final: true

  failed:
    entry: "console.log('âŒ Installation failed')"
    final: true
